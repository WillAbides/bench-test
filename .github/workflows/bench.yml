name: bench

on:
  push:

jobs:
  bench:
    runs-on: ubuntu-20.04
    env:
      benchdiff_version: "0.1.1"
    defaults:
      run:
        shell: bash
    steps:
      - run: |
          benchdiff_dir="${{ runner.temp }}/benchdiff"
          mkdir -p "$benchdiff_dir"
          cd $benchdiff_dir
          tarfile="benchdiff_${benchdiff_version}_linux_amd64.tar.gz"
          url="https://github.com/WillAbides/benchdiff/releases/download/v${benchdiff_version}/${tarfile}"
          curl -OL $url
          tar -xzf $tarfile
          echo "benchdiff_dir=\"$benchdiff_dir\"" >> $GITHUB_ENV
          echo "$benchdiff_dir" >> $GITHUB_PATH
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - run: benchdiff --base-ref=master
